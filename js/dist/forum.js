(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var r=t.n(e);const n=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/ForgotPasswordModal"];var i=t.n(o);function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}const l=flarum.core.compat["common/Component"];var s=function(t){function e(){return t.apply(this,arguments)||this}var r,n;n=t,(r=e).prototype=Object.create(n.prototype),r.prototype.constructor=r,a(r,n);var o=e.prototype;return o.oncreate=function(e){t.prototype.oncreate.call(this,e),this.attrs.state.render(e.dom.querySelector(".cf-turnstile"))},o.view=function(){return m("div",{className:"Form-group"},m("div",{className:"cf-turnstile"}))},e}(t.n(l)());const u=flarum.core.compat["common/components/Button"];var c=t.n(u);const d=flarum.core.compat["forum/components/ChangePasswordModal"];var p=t.n(d);const f=flarum.core.compat["forum/components/LogInModal"];var h=t.n(f),b=function(){function t(t,e){this.token=null,this.widgetId=void 0,this.callback=void 0,this.errorCallback=void 0,this.callback=t,this.errorCallback=e}var e=t.prototype;return e.render=function(t){var e=this;window.turnstile&&(this.widgetId=window.turnstile.render(t,{sitekey:r().forum.attribute("blazite-turnstile.site_key"),theme:r().forum.attribute("turnstile_dark_mode")?"dark":"light",size:"normal",callback:function(t){e.token=t,e.callback(t)},"expired-callback":function(){e.token=null},"error-callback":function(){e.token=null,e.errorCallback({type:"error",content:r().translator.trans("blazite-turnstile.forum.error")})}}))},e.getResponse=function(){return this.token},e.reset=function(){this.widgetId&&(window.turnstile.reset(this.widgetId),this.token=null)},e.isReady=function(){return void 0!==window.turnstile},t}();const g=flarum.core.compat["forum/components/SignUpModal"];var v=t.n(g);r().initializers.add("blazite/flarum-turnstile",(function(){var t;(0,n.extend)(v().prototype,"submitData",(function(t){r().forum.attribute("blazite-turnstile.signup")&&(t.turnstileToken=this.__turnstileToken)})),(0,n.extend)(v().prototype,"fields",(function(t){var e=this;r().forum.attribute("blazite-turnstile.signup")&&(this.turnstile=null,t.add("turnstile",m(s,{action:"sign_up",bindParent:this,onTurnstileStateChange:function(t){e.__turnstileToken=t}}),-5))})),(0,n.extend)(v().prototype,"onerror",(function(t,e){var n;r().forum.attribute("blazite-turnstile.signup")&&(null!=(n=this.turnstile)&&n.reset&&this.turnstile.reset(),!e.alert||e.alert.content&&e.alert.content.length||(e.alert.content=r().translator.trans("blazite-turnstile.forum.validation_error")||"Please complete the Turnstile challenge."),this.alertAttrs=e.alert,m.redraw(),this.onready())})),t=function(){return!!r().forum.attribute("blazite-turnstile.signin")},(0,n.extend)(h().prototype,"oninit",(function(){var e=this;t()&&(this.turnstile=new b((function(){}),(function(t){e.loaded(),e.alertAttrs=t})))})),(0,n.extend)(h().prototype,"loginParams",(function(e){t()&&(e.turnstileToken=this.turnstile.getResponse())})),(0,n.extend)(h().prototype,"fields",(function(e){t()&&e.add("turnstile",m(s,{state:this.turnstile}),-5)})),(0,n.extend)(h().prototype,"onerror",(function(e,n){t()&&(this.turnstile.reset(),!n.alert||n.alert.content&&n.alert.content.length||(n.alert.content=r().translator.trans("blazite-turnstile.forum.validation_error")))})),(0,n.extend)(i().prototype,"requestParams",(function(t){r().forum.attribute("blazite-turnstile.forgot")&&(t.turnstileToken=this.__turnstileToken)})),(0,n.extend)(i().prototype,"fields",(function(t){var e=this;r().forum.attribute("blazite-turnstile.forgot")&&(this.turnstile=null,t.add("turnstile",m(s,{action:"forgot_pw",bindParent:this,onTurnstileStateChange:function(t){e.__turnstileToken=t}}),-5))})),(0,n.extend)(i().prototype,"onerror",(function(t,e){var n;r().forum.attribute("blazite-turnstile.forgot")&&(null!=(n=this.turnstile)&&n.reset&&this.turnstile.reset(),!e.alert||e.alert.content&&e.alert.content.length||(e.alert.content=r().translator.trans("blazite-turnstile.forum.validation_error")||"Please complete the CAPTCHA challenge."),this.alertAttrs=e.alert,m.redraw(),this.onready())})),p().prototype.__turnstileToken=null,(0,n.extend)(p().prototype,"oninit",(function(){this.loading=!0})),(0,n.override)(p().prototype,"content",(function(t){var e=this;return r().forum.attribute("blazite-turnstile.forgot")?(this.turnstile=null,m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},r().translator.trans("core.forum.change_password.text")),m("div",{className:"Form-group"},c().component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading,disabled:this.loading},r().translator.trans("core.forum.change_password.send_button"))),m(s,{action:"forgot_pw",bindParent:this,onTurnstileStateChange:function(t){e.__turnstileToken=t,e.loading=!1,m.redraw()}})))):t()})),(0,n.override)(p().prototype,"onsubmit",(function(t,e){var n=this;if(!r().forum.attribute("blazite-turnstile.forgot"))return t.call(this,e);e.preventDefault(),this.loading=!0,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/forgot",body:{email:r().session.user.email(),turnstileToken:this.__turnstileToken}}).then(this.hide.bind(this)).catch((function(t){var e;null!=(e=n.turnstile)&&e.reset&&n.turnstile.reset(),!t.alert||t.alert.content&&t.alert.content.length||(t.alert.content=r().translator.trans("blazite-turnstile.forum.validation_error")||"Please complete the Turnstile challenge."),n.alertAttrs=t.alert,n.loading=!1,m.redraw(),n.onready()}))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map