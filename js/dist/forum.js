(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var r=t.n(e);const n=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/ForgotPasswordModal"];var i=t.n(o);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function l(t){var e=function(t){if("object"!=a(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}const c=flarum.core.compat["common/Component"];var d=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).widgetId=void 0,e.turnstileLoaded=void 0,e}var n,o;o=t,(n=e).prototype=Object.create(o.prototype),n.prototype.constructor=n,u(n,o);var i,a,l=e.prototype;return l.oninit=function(e){t.prototype.oninit.call(this,e),this.turnstileLoaded=!!window.turnstile},l.getCurrentTheme=function(){var t,e,n=null==(t=flarum.extensions["fof-nightmode"])?void 0:t.getTheme,o=null==(e=flarum.extensions["fof-nightmode"])?void 0:e.Themes;if(n&&o){var i=n();return i===o.AUTO&&(i=window.matchMedia("(prefers-color-scheme:dark)").matches?o.DARK:o.LIGHT),i===o.DARK?"dark":"light"}return r().forum.attribute("turnstile_dark_mode")?"dark":"light"},l.onTurnstileComplete=function(t){var e,r;null==(e=(r=this.attrs).onTurnstileStateChange)||e.call(r,t)},l.onTurnstileExpire=function(){var t,e;null==(t=(e=this.attrs).onTurnstileStateChange)||t.call(e,null)},l.onTurnstileError=function(){var t,e;null==(t=(e=this.attrs).onTurnstileStateChange)||t.call(e,null)},l.createTurnstile=function(){var t,e=this;this.turnstileLoaded&&(window.turnstile.render(this.element,this.config),this.widgetId=(null==(t=this.element.querySelector("[data-widget-id]"))?void 0:t.getAttribute("data-widget-id"))||void 0,this.attrs.bindParent&&(this.attrs.bindParent.turnstile={reset:function(){e.widgetId&&(window.turnstile.reset(e.widgetId),null==e.attrs.onTurnstileStateChange||e.attrs.onTurnstileStateChange(null))}}))},l.removeTurnstile=function(){this.turnstileLoaded&&this.widgetId&&window.turnstile.remove(this.widgetId)},l.oncreate=function(e){t.prototype.oncreate.call(this,e),this.createTurnstile()},l.onbeforeremove=function(e){t.prototype.onbeforeremove.call(this,e),this.removeTurnstile()},l.view=function(){return this.turnstileLoaded?m("div",{class:"Blazite-Turnstile Form-group"}):m("p",{class:"BlaziteTurnstile-notLoaded"},r().translator.trans("blazite-turnstile.forum.not_loaded_error"))},i=e,(a=[{key:"config",get:function(){return{action:this.attrs.action,theme:this.getCurrentTheme(),language:r().translator.getLocale()||"auto",sitekey:r().forum.attribute("blazite-turnstile.site_key"),size:"flexible",callback:this.onTurnstileComplete.bind(this),"expired-callback":this.onTurnstileExpire.bind(this),"error-callback":this.onTurnstileError.bind(this)}}}])&&s(i.prototype,a),Object.defineProperty(i,"prototype",{writable:!1}),i}(t.n(c)());const f=flarum.core.compat["common/components/Button"];var h=t.n(f);const p=flarum.core.compat["forum/components/ChangePasswordModal"];var b=t.n(p);const g=flarum.core.compat["forum/components/LogInModal"];var v=t.n(g);const y=flarum.core.compat["forum/components/SignUpModal"];var T=t.n(y);r().initializers.add("blazite/flarum-turnstile",(function(){(0,n.extend)(T().prototype,"submitData",(function(t){r().forum.attribute("blazite-turnstile.signup")&&(t.turnstileToken=this.__turnstileToken)})),(0,n.extend)(T().prototype,"fields",(function(t){var e=this;r().forum.attribute("blazite-turnstile.signup")&&(this.turnstile=null,t.add("turnstile",m(d,{action:"sign_up",bindParent:this,onTurnstileStateChange:function(t){e.__turnstileToken=t}}),-5))})),(0,n.extend)(T().prototype,"onerror",(function(t,e){var n;r().forum.attribute("blazite-turnstile.signup")&&(null!=(n=this.turnstile)&&n.reset&&this.turnstile.reset(),!e.alert||e.alert.content&&e.alert.content.length||(e.alert.content=r().translator.trans("blazite-turnstile.forum.validation_error")||"Please complete the Turnstile challenge."),this.alertAttrs=e.alert,m.redraw(),this.onready())})),(0,n.extend)(v().prototype,"loginParams",(function(t){r().forum.attribute("blazite-turnstile.signin")&&(t.turnstileToken=this.__turnstileToken)})),(0,n.extend)(v().prototype,"fields",(function(t){var e=this;r().forum.attribute("blazite-turnstile.signin")&&(this.turnstile=null,t.add("turnstile",m(d,{action:"log_in",bindParent:this,onTurnstileStateChange:function(t){e.__turnstileToken=t}}),-5))})),(0,n.extend)(v().prototype,"onerror",(function(t,e){var n;r().forum.attribute("blazite-turnstile.signin")&&(null!=(n=this.turnstile)&&n.reset&&this.turnstile.reset(),this.__turnstileToken=null,!e.alert||e.alert.content&&e.alert.content.length||(e.alert.content=r().translator.trans("blazite-turnstile.forum.validation_error")||"Please complete the CAPTCHA."),this.alertAttrs=e.alert,m.redraw(),this.onready())})),(0,n.extend)(i().prototype,"requestParams",(function(t){r().forum.attribute("blazite-turnstile.forgot")&&(t.turnstileToken=this.__turnstileToken)})),(0,n.extend)(i().prototype,"fields",(function(t){var e=this;r().forum.attribute("blazite-turnstile.forgot")&&(this.turnstile=null,t.add("turnstile",m(d,{action:"forgot_pw",bindParent:this,onTurnstileStateChange:function(t){e.__turnstileToken=t}}),-5))})),(0,n.extend)(i().prototype,"onerror",(function(t,e){var n;r().forum.attribute("blazite-turnstile.forgot")&&(null!=(n=this.turnstile)&&n.reset&&this.turnstile.reset(),!e.alert||e.alert.content&&e.alert.content.length||(e.alert.content=r().translator.trans("blazite-turnstile.forum.validation_error")||"Please complete the CAPTCHA challenge."),this.alertAttrs=e.alert,m.redraw(),this.onready())})),b().prototype.__turnstileToken=null,(0,n.extend)(b().prototype,"oninit",(function(){this.loading=!0})),(0,n.override)(b().prototype,"content",(function(t){var e=this;return r().forum.attribute("blazite-turnstile.forgot")?(this.turnstile=null,m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},r().translator.trans("core.forum.change_password.text")),m("div",{className:"Form-group"},h().component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading,disabled:this.loading},r().translator.trans("core.forum.change_password.send_button"))),m(d,{action:"forgot_pw",bindParent:this,onTurnstileStateChange:function(t){e.__turnstileToken=t,e.loading=!1,m.redraw()}})))):t()})),(0,n.override)(b().prototype,"onsubmit",(function(t,e){var n=this;if(!r().forum.attribute("blazite-turnstile.forgot"))return t.call(this,e);e.preventDefault(),this.loading=!0,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/forgot",body:{email:r().session.user.email(),turnstileToken:this.__turnstileToken}}).then(this.hide.bind(this)).catch((function(t){var e;null!=(e=n.turnstile)&&e.reset&&n.turnstile.reset(),!t.alert||t.alert.content&&t.alert.content.length||(t.alert.content=r().translator.trans("blazite-turnstile.forum.validation_error")||"Please complete the Turnstile challenge."),n.alertAttrs=t.alert,n.loading=!1,m.redraw(),n.onready()}))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map