{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://blazite-flarum-turnstile/webpack/bootstrap","webpack://blazite-flarum-turnstile/webpack/runtime/compat get default export","webpack://blazite-flarum-turnstile/webpack/runtime/define property getters","webpack://blazite-flarum-turnstile/webpack/runtime/hasOwnProperty shorthand","webpack://blazite-flarum-turnstile/external root \"flarum.core.compat['forum/app']\"","webpack://blazite-flarum-turnstile/external root \"flarum.core.compat['common/extend']\"","webpack://blazite-flarum-turnstile/external root \"flarum.core.compat['forum/components/ForgotPasswordModal']\"","webpack://blazite-flarum-turnstile/external root \"flarum.core.compat['forum/components/LogInModal']\"","webpack://blazite-flarum-turnstile/external root \"flarum.core.compat['forum/components/SignUpModal']\"","webpack://blazite-flarum-turnstile/./src/common/states/TurnstileState.ts","webpack://blazite-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://blazite-flarum-turnstile/external root \"flarum.core.compat['common/Component']\"","webpack://blazite-flarum-turnstile/./src/forum/components/Turnstile.tsx","webpack://blazite-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://blazite-flarum-turnstile/./src/forum/extendAuthModals.tsx","webpack://blazite-flarum-turnstile/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ForgotPasswordModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/SignUpModal'];","import app from 'flarum/forum/app';\r\n\r\nexport default class TurnstileState {\r\n  token = null;\r\n  widgetId = undefined;\r\n  callback;\r\n  errorCallback;\r\n\r\n  constructor(callback, errorCallback) {\r\n    this.callback = callback;\r\n    this.errorCallback = errorCallback;\r\n  }\r\n\r\n  render(element) {\r\n    if (!window.turnstile) return;\r\n\r\n    this.widgetId = window.turnstile.render(element, {\r\n      sitekey: app.forum.attribute('blazite-turnstile.site_key'),\r\n      theme: app.forum.attribute('turnstile_dark_mode') ? 'dark' : 'light',\r\n      size: 'normal',\r\n      callback: (token) => {\r\n        this.token = token;\r\n        this.callback(token);\r\n      },\r\n      'expired-callback': () => {\r\n        this.token = null;\r\n      },\r\n      'error-callback': () => {\r\n        this.token = null;\r\n        this.errorCallback({\r\n          type: 'error',\r\n          content: app.translator.trans('blazite-turnstile.forum.error'),\r\n        });\r\n      },\r\n    });\r\n  }\r\n\r\n  getResponse() {\r\n    return this.token;\r\n  }\r\n\r\n  reset() {\r\n    if (this.widgetId) {\r\n      window.turnstile.reset(this.widgetId);\r\n      this.token = null;\r\n    }\r\n  }\r\n\r\n  isReady() {\r\n    return typeof window.turnstile !== 'undefined';\r\n  }\r\n}","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","import Component from 'flarum/common/Component';\n\nexport default class Turnstile extends Component<{ state: any }> {\n  oncreate(vnode) {\n    super.oncreate(vnode);\n    this.attrs.state.render(vnode.dom.querySelector('.cf-turnstile'));\n  }\n\n  view() {\n    return (\n      <div className=\"Form-group\">\n        <div className=\"cf-turnstile\" />\n      </div>\n    );\n  }\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","import app from 'flarum/forum/app';\r\nimport { extend, override } from 'flarum/common/extend';\r\nimport ForgotPasswordModal from 'flarum/forum/components/ForgotPasswordModal';\r\nimport LogInModal from 'flarum/forum/components/LogInModal';\r\nimport SignUpModal from 'flarum/forum/components/SignUpModal';\r\n\r\nimport TurnstileState from '../common/states/TurnstileState';\r\nimport Turnstile from './components/Turnstile';\r\n\r\nconst addTurnstileToAuthModal = <T extends typeof ForgotPasswordModal | typeof LogInModal | typeof SignUpModal>({\r\n  modal,\r\n  type,\r\n  dataMethod,\r\n}: {\r\n  modal: T;\r\n  type: 'forgot' | 'signin' | 'signup';\r\n  dataMethod: 'requestParams' | 'loginParams' | 'submitData';\r\n}) => {\r\n  const isEnabled = () => !!app.forum.attribute(`blazite-turnstile.${type}`);\r\n\r\n  extend(modal.prototype, 'oninit', function () {\r\n    if (!isEnabled()) return;\r\n\r\n    this.turnstile = new TurnstileState(\r\n      () => {},\r\n      (alertAttrs) => {\r\n        this.loaded?.();\r\n        this.alertAttrs = alertAttrs;\r\n      }\r\n    );\r\n  });\r\n\r\n  extend(modal.prototype, dataMethod, function (data) {\r\n    if (!isEnabled()) return;\r\n    data.turnstileToken = this.turnstile.getResponse();\r\n  });\r\n\r\n  extend(modal.prototype, 'fields', function (fields) {\r\n    if (!isEnabled()) return;\r\n    fields.add(\r\n      'turnstile',\r\n      <Turnstile state={this.turnstile} />,\r\n      -5\r\n    );\r\n  });\r\n\r\n  extend(modal.prototype, 'onerror', function (_, error) {\r\n    if (!isEnabled()) return;\r\n\r\n    this.turnstile.reset();\r\n\r\n    if (error.alert && (!error.alert.content || !error.alert.content.length)) {\r\n      error.alert.content = app.translator.trans('blazite-turnstile.forum.validation_error');\r\n    }\r\n\r\n    this.alertAttrs = error.alert;\r\n    m.redraw();\r\n    this.onready?.();\r\n  });\r\n};\r\n\r\nexport default function extendAuthModalsWithTurnstile() {\r\n  addTurnstileToAuthModal({\r\n    modal: ForgotPasswordModal,\r\n    type: 'forgot',\r\n    dataMethod: 'requestParams',\r\n  });\r\n\r\n  addTurnstileToAuthModal({\r\n    modal: LogInModal,\r\n    type: 'signin',\r\n    dataMethod: 'loginParams',\r\n  });\r\n\r\n  addTurnstileToAuthModal({\r\n    modal: SignUpModal,\r\n    type: 'signup',\r\n    dataMethod: 'submitData',\r\n  });\r\n}","import app from 'flarum/forum/app';\nimport extendAuthModalsWithTurnstile from './extendAuthModals';\n\napp.initializers.add('blazite/turnstile', () => {\n  extendAuthModalsWithTurnstile();\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","TurnstileState","callback","errorCallback","token","widgetId","undefined","this","_proto","render","element","_this","window","turnstile","sitekey","app","attribute","theme","size","type","content","trans","getResponse","reset","isReady","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","Turnstile","_Component","apply","arguments","create","constructor","oncreate","vnode","attrs","state","dom","querySelector","view","m","className","Component","addTurnstileToAuthModal","_ref","modal","dataMethod","isEnabled","extend","alertAttrs","loaded","data","turnstileToken","fields","add","_","error","_this$onready","alert","length","redraw","onready","ForgotPasswordModal","LogInModal","SignUpModal"],"sourceRoot":""}